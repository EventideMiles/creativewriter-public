<!-- ============================================
     UI Settings - Appearance Tab
     Accordion-based layout matching API Settings
     ============================================ -->

<ion-accordion-group [multiple]="true" [value]="['text-color', 'background']" class="appearance-accordion">

  <!-- Text Color Section -->
  <ion-accordion value="text-color">
    <ion-item slot="header" lines="full">
      <ion-icon name="text-outline" slot="start"></ion-icon>
      <ion-label>
        <h3>Text Color</h3>
        <p>Customize editor and Beat AI text appearance</p>
      </ion-label>
      <div class="color-preview" slot="end" [style.background-color]="settings.appearance.textColor"></div>
    </ion-item>
    <div slot="content" class="accordion-content">
      <p class="section-description">
        This color is used for text in the story editor and Beat AI input fields.
      </p>
      <app-color-picker
        [color]="settings.appearance.textColor"
        (colorChange)="onTextColorChange($event)">
      </app-color-picker>
    </div>
  </ion-accordion>

  <!-- Direct Speech Color Section -->
  <ion-accordion value="direct-speech-color">
    <ion-item slot="header" lines="full">
      <ion-icon name="chatbubble-outline" slot="start"></ion-icon>
      <ion-label>
        <h3>Dialogue Color</h3>
        <p>Color for quoted text (direct speech)</p>
      </ion-label>
      <div class="color-preview-with-badge" slot="end">
        <div class="color-preview" [style.background-color]="getEffectiveDirectSpeechColor()"></div>
        <ion-badge *ngIf="isUsingAutomaticColor()" color="medium" class="auto-badge">Auto</ion-badge>
      </div>
    </ion-item>
    <div slot="content" class="accordion-content">
      <p class="section-description">
        Text in double quotes ("dialogue") is highlighted in this color.
        By default, it derives from your text color with a slight tint.
      </p>

      <div class="color-mode-toggle">
        <button
          class="mode-button"
          [class.active]="isUsingAutomaticColor()"
          (click)="resetDirectSpeechColorToAuto()">
          <ion-icon name="color-wand-outline"></ion-icon>
          <span>Auto (from text color)</span>
        </button>
        <button
          class="mode-button"
          [class.active]="!isUsingAutomaticColor()"
          (click)="onDirectSpeechColorChange(getEffectiveDirectSpeechColor())">
          <ion-icon name="color-palette-outline"></ion-icon>
          <span>Custom</span>
        </button>
      </div>

      <div class="color-picker-section" [class.disabled]="isUsingAutomaticColor()">
        <app-color-picker
          [color]="getEffectiveDirectSpeechColor()"
          (colorChange)="onDirectSpeechColorChange($event)">
        </app-color-picker>
      </div>

      <div class="preview-section">
        <p class="preview-label">Preview:</p>
        <div class="dialogue-preview" [style.color]="settings.appearance.textColor">
          He leaned closer. <span [style.color]="getEffectiveDirectSpeechColor()">"I have something to tell you,"</span> he whispered.
        </div>
      </div>
    </div>
  </ion-accordion>

  <!-- Background Image Section -->
  <ion-accordion value="background">
    <ion-item slot="header" lines="full">
      <ion-icon name="image-outline" slot="start"></ion-icon>
      <ion-label>
        <h3>Background Image</h3>
        <p>Choose or upload a custom background</p>
      </ion-label>
      <ion-badge slot="end" color="primary">
        {{ getBackgroundLabel() }}
      </ion-badge>
    </ion-item>
    <div slot="content" class="accordion-content">
      <!-- Built-in Backgrounds -->
      <div class="background-subsection">
        <h4>Built-in Backgrounds</h4>
        <app-background-selector
          [selectedBackgroundImage]="settings.appearance.backgroundImage"
          (backgroundImageChange)="onBackgroundImageChange($event)">
        </app-background-selector>
      </div>

      <!-- Custom Upload -->
      <div class="background-subsection">
        <h4>Upload Custom Background</h4>
        <p class="subsection-description">
          Upload your own images for a personalized writing environment.
        </p>
        <app-background-upload
          (backgroundUploaded)="onBackgroundUploaded($event)">
        </app-background-upload>
      </div>
    </div>
  </ion-accordion>

</ion-accordion-group>
