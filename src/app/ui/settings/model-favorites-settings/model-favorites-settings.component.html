<ng-container *ngIf="showCard; else noCardContent">
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ cardTitle }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p class="description">
        {{ description }}
      </p>
      <ng-container *ngTemplateOutlet="favoritesContent"></ng-container>
    </ion-card-content>
  </ion-card>
</ng-container>

<ng-template #noCardContent>
  <ng-container *ngTemplateOutlet="favoritesContent"></ng-container>
</ng-template>

<ng-template #favoritesContent>
  <section class="favorites-section">
    <h3 class="section-heading" *ngIf="showCard">{{ heading }}</h3>
    <p class="section-subheading" *ngIf="showCard">
      {{ subheading }}
    </p>

    <div class="select-wrapper">
      <ng-select
        [(ngModel)]="selectedFavorites"
        (ngModelChange)="onFavoritesChange($event)"
        [items]="combinedModels"
        bindLabel="label"
        bindValue="id"
        [multiple]="true"
        [maxSelectedItems]="maxFavorites"
        [loading]="loadingModels"
        [virtualScroll]="true"
        [searchable]="true"
        appendTo="body"
        placeholder="Select favorite models"
        class="ng-select-custom"
        [clearable]="false">
        <ng-template ng-option-tmp let-item="item">
          <div class="model-option">
            <app-provider-icon
              [provider]="item.provider"
              [size]="16"
              class="provider-icon"
              [class.openrouter]="item.provider === 'openrouter'"
              [class.claude]="item.provider === 'claude'"
              [class.replicate]="item.provider === 'replicate'"
              [class.ollama]="item.provider === 'ollama'"
              [class.gemini]="item.provider === 'gemini'">
            </app-provider-icon>
            <div class="model-info">
              <div class="model-label">{{ item.label }}</div>
              <div class="model-meta">{{ item.provider }}</div>
            </div>
          </div>
        </ng-template>
        <ng-template ng-multi-label-tmp let-items="items">
          <div class="selected-text" [title]="formatSelectedItems(items)">
            {{ formatSelectedItems(items) }}
          </div>
        </ng-template>
      </ng-select>
    </div>

    <ion-note color="danger" *ngIf="modelLoadError">{{ modelLoadError }}</ion-note>
    <p class="info-note" *ngIf="!modelLoadError && !loadingModels && !combinedModels.length && infoNote">
      {{ infoNote }}
    </p>
    <div class="loading-state" *ngIf="loadingModels">
      <ion-spinner name="crescent"></ion-spinner>
      <span>Loading modelsâ€¦</span>
    </div>

    <div class="favorites-list" *ngIf="favoriteModelOptions.length > 0">
      <ion-reorder-group (ionItemReorder)="onReorder($event)" [disabled]="favoriteModelOptions.length <= 1">
        <ion-item *ngFor="let model of favoriteModelOptions; let index = index; trackBy: trackById">
          <ion-reorder slot="start"></ion-reorder>
          <div class="favorite-item-content">
            <span class="favorite-index">#{{ index + 1 }}</span>
            <app-provider-icon
              [provider]="model.provider"
              [size]="18"
              class="provider-icon"
              [class.openrouter]="model.provider === 'openrouter'"
              [class.claude]="model.provider === 'claude'"
              [class.replicate]="model.provider === 'replicate'"
              [class.ollama]="model.provider === 'ollama'"
              [class.gemini]="model.provider === 'gemini'">
            </app-provider-icon>
            <ion-label>
              <h4>{{ model.label }}</h4>
              <p>{{ model.provider }}</p>
            </ion-label>
          </div>
          <ion-button fill="clear" color="medium" slot="end" (click)="removeFavorite(model.id)">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-reorder-group>
    </div>

    <p class="empty-state" *ngIf="!favoriteModelOptions.length && !loadingModels">
      {{ emptyState }}
    </p>
  </section>
</ng-template>
