<div class="premium-settings">
  <div class="tab-header">
    <h2>
      <ion-icon name="star" class="premium-icon"></ion-icon>
      Premium Subscription
    </h2>
    <p>Manage your CreativeWriter premium subscription</p>
  </div>

  <ion-accordion-group [multiple]="true" [value]="getDefaultExpandedAccordions()" class="premium-accordion">

    <!-- Subscription Status -->
    <ion-accordion value="status">
      <ion-item slot="header" lines="full">
        <ion-icon [name]="isPremium ? 'checkmark-circle' : 'close-circle'" slot="start" [class.active]="isPremium"></ion-icon>
        <ion-label>
          <h3>Subscription Status</h3>
          <p>Verify and manage your subscription</p>
        </ion-label>
        <ion-badge slot="end" [color]="isPremium ? 'success' : 'medium'">
          {{ isPremium ? 'Active' : 'Not Active' }}
        </ion-badge>
      </ion-item>
      <div slot="content" class="accordion-content">
        <div class="settings-group">
          <!-- Status Display -->
          <div class="status-display" *ngIf="isPremium">
            <div class="status-badges">
              <span class="plan-badge" *ngIf="plan">{{ plan | titlecase }} Plan</span>
              <span class="expires-text" *ngIf="expiresAt">
                Expires: {{ expiresAt | date:'mediumDate' }}
              </span>
            </div>
          </div>

          <!-- Email Input -->
          <div class="input-group">
            <ion-label position="stacked">
              <h4>Subscription Email</h4>
              <p>Enter the email used for your subscription</p>
            </ion-label>
            <ion-item class="input-item">
              <ion-input
                type="email"
                [(ngModel)]="email"
                placeholder="your@email.com"
                (ionBlur)="onEmailBlur()">
              </ion-input>
            </ion-item>
            <ion-note class="input-note">
              You'll verify via Stripe's secure login page (email + one-time code).
            </ion-note>
          </div>

          <!-- Verify Button -->
          <ion-button
            expand="block"
            class="verify-button"
            (click)="verifySubscription()"
            [disabled]="isVerifying || verificationPending || !email">
            <ion-spinner *ngIf="isVerifying || verificationPending" name="crescent" slot="start"></ion-spinner>
            <ion-icon *ngIf="!isVerifying && !verificationPending" name="refresh" slot="start"></ion-icon>
            {{ isVerifying || verificationPending ? 'Verifying...' : 'Verify via Stripe Portal' }}
          </ion-button>

          <!-- Error/Success Message -->
          <div *ngIf="message" class="message" [class.success]="messageType === 'success'" [class.error]="messageType === 'error'">
            {{ message }}
          </div>
        </div>
      </div>
    </ion-accordion>

    <!-- Premium Features -->
    <ion-accordion value="features">
      <ion-item slot="header" lines="full">
        <ion-icon name="sparkles-outline" slot="start"></ion-icon>
        <ion-label>
          <h3>Premium Features</h3>
          <p>What's included in your subscription</p>
        </ion-label>
        <ion-badge slot="end" color="primary">
          {{ isPremium ? 'Unlocked' : 'Locked' }}
        </ion-badge>
      </ion-item>
      <div slot="content" class="accordion-content">
        <div class="features-list">
          <div class="feature-item" [class.unlocked]="isPremium">
            <ion-icon [name]="isPremium ? 'checkmark-circle' : 'lock-closed'" [class.unlocked]="isPremium"></ion-icon>
            <div class="feature-content">
              <h4>AI Rewrite</h4>
              <p>Context-aware text rewriting with AI assistance</p>
            </div>
          </div>
          <div class="feature-item" [class.unlocked]="isPremium">
            <ion-icon [name]="isPremium ? 'checkmark-circle' : 'lock-closed'" [class.unlocked]="isPremium"></ion-icon>
            <div class="feature-content">
              <h4>Character Chat</h4>
              <p>Interview your characters and explore their personalities</p>
            </div>
          </div>
          <div class="feature-item" [class.unlocked]="isPremium">
            <ion-icon [name]="isPremium ? 'checkmark-circle' : 'lock-closed'" [class.unlocked]="isPremium"></ion-icon>
            <div class="feature-content">
              <h4>AI Portrait Generation</h4>
              <p>Generate character portraits from descriptions</p>
            </div>
          </div>
          <div class="feature-item coming-soon">
            <ion-icon name="time-outline"></ion-icon>
            <div class="feature-content">
              <h4>More Features</h4>
              <p>Additional premium features coming soon...</p>
            </div>
          </div>
        </div>
      </div>
    </ion-accordion>

    <!-- Portrait Model Settings (Premium only) -->
    <ion-accordion value="portrait" *ngIf="isPremium">
      <ion-item slot="header" lines="full">
        <ion-icon name="image-outline" slot="start"></ion-icon>
        <ion-label>
          <h3>Portrait Generation</h3>
          <p>Configure AI model for character portraits</p>
        </ion-label>
        <ion-badge slot="end" color="primary">
          {{ portraitModel === 'flux' ? 'Flux' : 'Seedream' }}
        </ion-badge>
      </ion-item>
      <div slot="content" class="accordion-content">
        <div class="settings-group">
          <div class="select-group">
            <ion-label position="stacked">
              <h4>Image Generation Model</h4>
              <p>Choose the AI model for generating character portraits</p>
            </ion-label>
            <ion-item class="select-item">
              <ion-select
                [(ngModel)]="portraitModel"
                (ngModelChange)="onPortraitModelChange()"
                interface="popover">
                <ion-select-option value="flux">Flux (Black Forest Labs)</ion-select-option>
                <ion-select-option value="seedream">Seedream 4.5 (ByteDance)</ion-select-option>
              </ion-select>
            </ion-item>
          </div>
        </div>
      </div>
    </ion-accordion>

    <!-- Get Premium (Non-premium only) -->
    <ion-accordion value="subscribe" *ngIf="!isPremium">
      <ion-item slot="header" lines="full">
        <ion-icon name="card-outline" slot="start"></ion-icon>
        <ion-label>
          <h3>Get Premium</h3>
          <p>Choose a plan and unlock all features</p>
        </ion-label>
        <ion-badge slot="end" color="warning">
          Subscribe
        </ion-badge>
      </ion-item>
      <div slot="content" class="accordion-content">
        <div class="pricing-section">
          <stripe-pricing-table
            [attr.pricing-table-id]="stripePricingTableId"
            [attr.publishable-key]="stripePublishableKey"
            [attr.customer-email]="email || null">
          </stripe-pricing-table>
        </div>
      </div>
    </ion-accordion>

  </ion-accordion-group>
</div>
