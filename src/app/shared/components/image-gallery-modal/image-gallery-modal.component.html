<ion-modal
  [isOpen]="isOpen"
  (willPresent)="onModalWillPresent()"
  (didDismiss)="onModalDidDismiss()"
  [backdropDismiss]="true"
  class="gallery-modal"
>
  <ng-template>
    <ion-header class="gallery-header">
      <ion-toolbar>
        <ion-title>{{ currentIndex + 1 }} of {{ images.length }}</ion-title>
        <ion-buttons slot="end">
          <ion-button fill="clear" (click)="downloadCurrent()" aria-label="Download current image">
            <ion-icon slot="icon-only" name="download-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" (click)="onClose()" aria-label="Close gallery">
            <ion-icon slot="icon-only" name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="gallery-content">
      <div class="swiper-container">
        <swiper-container
          #swiperRef
          [initialSlide]="initialIndex"
          [slidesPerView]="1"
          [spaceBetween]="0"
          [centeredSlides]="true"
          [keyboard]="{ enabled: true }"
          [zoom]="{ maxRatio: 3 }"
          (slidechange)="onSlideChange($event)"
        >
          <swiper-slide *ngFor="let image of images; let i = index">
            <div class="swiper-zoom-container">
              <img [src]="image.url" [alt]="prompt || 'Generated image ' + (i + 1)" loading="lazy" />
            </div>
          </swiper-slide>
        </swiper-container>

        <!-- Navigation arrows -->
        <button
          *ngIf="images.length > 1"
          class="nav-button prev"
          (click)="previousSlide()"
          [disabled]="currentIndex === 0"
          aria-label="Previous image"
        >
          <ion-icon name="chevron-back"></ion-icon>
        </button>
        <button
          *ngIf="images.length > 1"
          class="nav-button next"
          (click)="nextSlide()"
          [disabled]="currentIndex === images.length - 1"
          aria-label="Next image"
        >
          <ion-icon name="chevron-forward"></ion-icon>
        </button>
      </div>

      <!-- Image counter dots -->
      <div class="pagination-dots" *ngIf="images.length > 1 && images.length <= 10">
        <span
          *ngFor="let image of images; let i = index"
          class="dot"
          [class.active]="i === currentIndex"
        ></span>
      </div>

      <!-- Prompt display -->
      <div class="prompt-display" *ngIf="prompt">
        <p>{{ prompt }}</p>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>
